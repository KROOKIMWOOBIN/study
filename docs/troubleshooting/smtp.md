## 1. 배경
```markdown
운영 중인 서비스에서
특정 고객이 메일을 수신하지 못한다는 문의가 접수됨.
해당 서비스는 JavaMail 기반 메일 발송 기능을 사용 중이었으며,
기존 설정은 SMTP 25 포트를 사용하고 있었음.
```

## 2. 문제 현상
- 일부 고객에게 메일이 도달하지 않음
- 발송 로직 상 에러 로그는 발생하지 않음
- 내부 테스트 메일은 정상 발송됨

## 3. 원인 분석 과정
- 메일 발송 설정 확인
  - 확인 결과 smtp + 25 포트 사용 중
- 네트워크 경로 확인
  - 서비스가 위치한 방화벽과 메일 서버가 위치한 방화벽이 서로 다름
- 공인 IP 확인
  - 메일 발송 시 외부 통신 구간에서 SK177 공인 IP가 소스 IP로 사용되어 메일 서버에 전달됨
- 수신 측 스팸 필터 동작 확인
  - 수신 측 메일 서버에서 해당 공인 IP(SK177)를 스팸 발송 이력 IP로 인식

## 4. 원인
```markdown
SMTP 25 포트 사용 시 방화벽 간 통신 구간에서
SK177 공인 IP가 메일 발송의 소스 IP로 인식되어
수신 측 메일 서버에서 스팸으로 차단됨.
```

## 5. 해결 방법
- 메일 발송 방식을 SMTP → SMTPS 로 변경
- 포트를 25 → 465 로 변경
- SMTPS(465)를 사용하여 메일 서버와 직접 암호화된 세션을 구성함으로써 메일 발송 주체가 메일 서버 IP로 명확히 인식되도록 함
```markdown
변경 전: smtp / 25
변경 후: smtps / 465
```

## 6. 결과
- 수신 실패 고객 메일 정상 수신 확인
- 발송 IP가 메일 서버 IP로 정상 인식됨
- 추가 스팸 차단 사례 발생하지 않음

## 7. 회고 / 배운 점
```markdown
- 방화벽 간 통신 시 발신 IP가 단순히 변환(NAT)되는 것이 아니라,
  외부 통신 과정에서 SK177 공인 IP가 소스 IP로 사용되어 메일 서버에 전달될 수 있음을 알게 됨

- 동일한 메일 발송 로직임에도 다른 프로젝트에서 문제가 발생하지 않았던 이유를 확인한 결과,
  애플리케이션 서버와 메일 서버가 동일 방화벽 내에 위치한 경우에는
  사설 IP로 직접 통신하여 해당 이슈가 발생하지 않았음

- 메일 수신 실패 이슈는 SMTP 설정뿐 아니라
  방화벽 정책 및 공인 IP 사용 여부에 따라 발송 IP 인식이 달라질 수 있음을 고려해야 함
```